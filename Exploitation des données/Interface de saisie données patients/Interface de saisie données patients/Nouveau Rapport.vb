Public Class Nouveau_Rapport

    Private Sub bt_add_patient_Click(sender As Object, e As EventArgs) Handles bt_add_patient.Click
        Dim ajout_patient As New Ajout_patient(Me)
        ajout_patient.Show()
    End Sub

    Private Sub Nouveau_Rapport_Load(sender As Object, e As EventArgs) Handles Me.Load
        Me.CenterToScreen()
        refresh_cbx_patient()
    End Sub

    Public Sub refresh_cbx_patient()
        Dim patients As New DataTable
        Dim bdd As New DataBase

        patients = bdd.select_data("SELECT nom, prenom, id FROM patient", "patient").Tables(0)
        patients.Columns.Add("checkbox_display")

        For Each row As DataRow In patients.Rows
            row("checkbox_display") = row("nom") & " " & row("prenom")
        Next
        With Me.cbx_patient
            .DisplayMember = "checkbox_display"
            .ValueMember = "id"
            .DataSource = patients
            .DropDownStyle = ComboBoxStyle.DropDown
            .AutoCompleteMode = AutoCompleteMode.Suggest
            .AutoCompleteSource = AutoCompleteSource.ListItems
        End With
    End Sub

    Private Sub Button1_Click(sender As Object, e As EventArgs) Handles bt_enregistrer.Click
        'Prepare all variables according to scheme
        Dim table_manger As String = ""
        Dim lit As String = ""
        Dim petit_dejeuner As String = ""
        Dim dejeuner As String = ""
        Dim vaisselle As String = ""
        Dim sol As String = ""
        Dim commentaire As String = ""

        Dim id_patient As Integer
        Dim bdd As New DataBase
        Dim rq As String

        If (Me.cbx_patient.SelectedIndex = -1) Then
            MsgBox("Vous n'avez pas saisi de patient", vbInformation)
            Exit Sub
        Else
            id_patient = Me.cbx_patient.SelectedValue
        End If

        For Each ctrl As Control In Me.gpb__verifications.Controls
            If TypeOf (ctrl) Is CheckedListBox Then
                Dim chk_list As CheckedListBox = CType(ctrl, CheckedListBox)

                If chk_list.CheckedItems.Count <> 0 Then

                    Select Case chk_list.Name
                        Case "chk_list_table"
                            table_manger = chk_list.CheckedItems(0).ToString()

                        Case "chk_list_lit"
                            lit = chk_list.CheckedItems(0).ToString()

                        Case "chk_list_petit_dej"
                            petit_dejeuner = chk_list.CheckedItems(0).ToString()

                        Case "chk_list_dej"
                            dejeuner = chk_list.CheckedItems(0).ToString()

                        Case "chk_list_vaisselle"
                            vaisselle = chk_list.CheckedItems(0).ToString()

                        Case "chk_list_sol"
                            sol = chk_list.CheckedItems(0).ToString()

                        Case Else
                            MsgBox("Une erreur est survenue lors de l'association des champs / valeurs.", vbCritical)
                    End Select
                Else
                    MsgBox("Il manque des informations. Merci de vérifier que chaque catégorie à une case de cochée.", vbInformation)
                    Exit Sub
                End If

            End If
        Next

        commentaire = Me.txt_commentaire.Text

        rq = "INSERT INTO RAPPORT_VERIFICATION (id_patient, table_manger, lit, petit_dejeuner, dejeuner, vaisselle, sol, commentaire) VALUES ('" &
             id_patient & "','" & table_manger & "','" & lit & "','" & petit_dejeuner & "','" & dejeuner & "','" & vaisselle & "','" & sol & "','" & commentaire & "');"
        If bdd.insert_into(rq) = 1 Then

            MsgBox("Insertion réussie")

        End If

    End Sub

#Region "Checked list control (only one item selected)"
    Private Sub chk_list_dej_ItemCheck(ByVal sender As Object, ByVal e As System.Windows.Forms.ItemCheckEventArgs) Handles chk_list_dej.ItemCheck
        If e.NewValue = CheckState.Checked Then
            For i As Integer = 0 To Me.chk_list_dej.Items.Count - 1 Step 1
                If i <> e.Index Then
                    Me.chk_list_dej.SetItemChecked(i, False)
                End If
            Next i
        End If
    End Sub

    Private Sub chk_list_lit_ItemCheck(ByVal sender As Object, ByVal e As System.Windows.Forms.ItemCheckEventArgs) Handles chk_list_lit.ItemCheck
        If e.NewValue = CheckState.Checked Then
            For i As Integer = 0 To Me.chk_list_lit.Items.Count - 1 Step 1
                If i <> e.Index Then
                    Me.chk_list_lit.SetItemChecked(i, False)
                End If
            Next i
        End If
    End Sub

    Private Sub chk_list_sol_ItemCheck(ByVal sender As Object, ByVal e As System.Windows.Forms.ItemCheckEventArgs) Handles chk_list_sol.ItemCheck
        If e.NewValue = CheckState.Checked Then
            For i As Integer = 0 To Me.chk_list_sol.Items.Count - 1 Step 1
                If i <> e.Index Then
                    Me.chk_list_sol.SetItemChecked(i, False)
                End If
            Next i
        End If
    End Sub

    Private Sub chk_list_petit_dej_ItemCheck(ByVal sender As Object, ByVal e As System.Windows.Forms.ItemCheckEventArgs) Handles chk_list_petit_dej.ItemCheck
        If e.NewValue = CheckState.Checked Then
            For i As Integer = 0 To Me.chk_list_petit_dej.Items.Count - 1 Step 1
                If i <> e.Index Then
                    Me.chk_list_petit_dej.SetItemChecked(i, False)
                End If
            Next i
        End If
    End Sub

    Private Sub chk_list_table_ItemCheck(ByVal sender As Object, ByVal e As System.Windows.Forms.ItemCheckEventArgs) Handles chk_list_table.ItemCheck
        If e.NewValue = CheckState.Checked Then
            For i As Integer = 0 To Me.chk_list_table.Items.Count - 1 Step 1
                If i <> e.Index Then
                    Me.chk_list_table.SetItemChecked(i, False)
                End If
            Next i
        End If
    End Sub

    Private Sub chk_list_vaisselle_ItemCheck(ByVal sender As Object, ByVal e As System.Windows.Forms.ItemCheckEventArgs) Handles chk_list_vaisselle.ItemCheck
        If e.NewValue = CheckState.Checked Then
            For i As Integer = 0 To Me.chk_list_vaisselle.Items.Count - 1 Step 1
                If i <> e.Index Then
                    Me.chk_list_vaisselle.SetItemChecked(i, False)
                End If
            Next i
        End If
    End Sub
#End Region
End Class